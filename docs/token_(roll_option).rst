.. contents::
   :depth: 3
..

.. raw:: mediawiki

   {{RollOption
   |name=token
   |trusted=true
   |version=1.3.b48
   |description=

   '''token''' is a macro function that allows an associated code block to be executed as though it were executing with a specified token as the context.  This allows the code block to use properties of the token without special coding.

   This "context" function lasts only for the given code block.  References to variables within the code block will still be available when the code block finishes.  (Variables belong to the macro, while properties belong to the token.)

   |usage=
   <source lang="mtmacro" line>
   [token(identifier): single_statement]
   </source>
   <source lang="mtmacro" line>
   [token(identifier), code: {
      statement1
      statement2
   }]
   </source>

   The ''identifier'' is the name of the token.  The search first checks to see if the specified string is the Name of any token (i.e. matches [[token.name|token.name]]), then it checks GMName (i.e. matches [[token.gm_name|token.gm_name]]), and last it checks the unique [[TokenID|token id]] (this is a 32-character string generated by MapTool).

   If there are multiple tokens with the same name, such as '''Goblin''', then the ''GM Name'' field of the token should be unique so that it can be used to select tokens.  Note that the [[Macros:Functions:getAllTokens()|getAllTokens()]] and related functions return a list of token ids.
   |examples=
   <source lang="mtmacro" line>
   [h, token("Goblin 21"): health = floor(100*HP/HPmax)]
   The healthbar of <b>Goblin 21</b> should be at [r: health]%.
   </source>
   If '''Goblin 21''' has 32 hit points and a maximum hit points of 40 (and these numbers are stored in '''HP''' and '''HPmax''' properties, respectively), the output produced will be:

   :<tt>The healthbar of <b>Goblin 21</b> should be at 80%.</tt>

   |also=
   [[currentToken|currentToken()]], [[switchToken|switchToken()]],
   [[floor|floor()]].
   }}

`Category:Branching Roll Option <Category:Branching_Roll_Option>`__
